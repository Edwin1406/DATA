<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tabla Editable de Productos</title>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">
    <script type="text/javascript" charset="utf8" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
</head>
<body>

    <h1>Seleccionar Producto Directamente en la Tabla</h1>

    <table id="productos" class="display">
        <thead>
            <tr>
                <th>Cant.</th>
                <th>Prenda</th>
                <th>Composición</th>
                <th>Acción</th>
            </tr>
        </thead>
        <tbody>
            <!-- Las filas se agregarán dinámicamente aquí -->
            <tr>
                <td contenteditable="true">10</td>
                <td contenteditable="true">Blusa</td>
                <td contenteditable="true">100% Algodón</td>
                <td><button class="eliminar">Eliminar</button></td>
            </tr>
            <tr>
                <td contenteditable="true">5</td>
                <td contenteditable="true">Abrigo</td>
                <td contenteditable="true">60% Lana, 30% Poliéster</td>
                <td><button class="eliminar">Eliminar</button></td>
            </tr>
        </tbody>
    </table>

    <br><br>

    <button id="guardarProductos">Guardar Productos</button>

    <script>
        $(document).ready(function() {
            var table = $('#productos').DataTable();

            // Evento para eliminar una fila de la tabla
            $('#productos tbody').on('click', 'button.eliminar', function () {
                table.row($(this).parents('tr')).remove().draw();
            });

            // Evento para guardar los productos en la base de datos (con AJAX)
            $('#guardarProductos').on('click', function() {
                var data = table.rows().data().toArray(); // Obtener todos los datos de la tabla
                $.ajax({
                    url: 'guardar_productos.php',
                    type: 'POST',
                    data: { productos: JSON.stringify(data) },
                    success: function(response) {
                        alert('Productos guardados correctamente');
                    },
                    error: function() {
                        alert('Error al guardar los productos');
                    }
                });
            });

            // Se pueden editar las celdas directamente en la tabla
            $('#productos td[contenteditable="true"]').on('blur', function() {
                // Aquí puedes manejar el evento cuando el contenido editable se cambia
                var rowData = table.row($(this).closest('tr')).data();
                console.log(rowData); // Solo para ver los datos cambiados en consola
            });
        });
    </script>

</body>
</html>
